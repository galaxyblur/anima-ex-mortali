#!/bin/sh

# Get commit message
MSG=$(cat "$1")

# Skip check for certain commit types
# Conventional commit prefixes: chore, docs, ci, build, style, test, revert
# Merge/revert commits
# Release commits
if echo "$MSG" | grep -qE "^(chore|docs|ci|build|style|test|revert)(\(.+\))?:|^Merge |^Revert |^[Rr]elease |^v?[0-9]+\.[0-9]+"; then
  exit 0
fi

# Check if CHANGELOG.md is staged
if ! git diff --cached --name-only | grep -q "^CHANGELOG.md$"; then
  echo ""
  echo "ERROR: CHANGELOG.md not updated"
  echo ""
  echo "Every commit that changes functionality must update CHANGELOG.md."
  echo "Add your changes under the [Unreleased] section."
  echo ""
  echo "To skip this check for non-functional changes, use conventional commits:"
  echo "  chore: ...  docs: ...  ci: ...  build: ...  style: ...  test: ..."
  echo ""
  exit 1
fi
